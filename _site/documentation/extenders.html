<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Twinkql : Using extenders to augment observables</title>
        <link href="../css/tripoli.simple.css" type="text/css" rel="stylesheet" /> 
        <link rel="stylesheet" type="text/css" href="../css/styles.css" />
        <link rel="stylesheet" type="text/css" href="../css/smallScreen.css" media="only screen and (max-device-width: 800px)" />
        <!--[if IE]><link rel="stylesheet" type="text/css" href="../css/tripoli.simple.ie.css" /><![endif]-->
        <!--[if lte IE 7]><link rel="stylesheet" type="text/css" href="../css/ie6ie7.css" /><![endif]-->
        <!--[if lte IE 6]><link rel="stylesheet" type="text/css" href="../css/ie6.css" /><![endif]-->
        <script type="text/javascript" src="../js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="../js/knockout-2.1.0.js"></script>
<script type="text/javascript" src="../js/cufon-yui.js"></script>
<script type="text/javascript" src="../js/titilliummaps.font.js"></script>
<script type="text/javascript" src="../js/json2.js"></script>

<!--[if lt IE 7]>
<script defer type="text/javascript" src="../js/ie6pngfix.js"></script>
<![endif]-->

<script type="text/javascript" src="../js/syntaxhighlighter_3.0.83/scripts/shCore.js"></script> 
<script type="text/javascript" src="../js/syntaxhighlighter_3.0.83/scripts/shBrushJava.js"></script> 
<script type="text/javascript" src="../js/syntaxhighlighter_3.0.83/scripts/shBrushJScript.js"></script> 
<script type="text/javascript" src="../js/syntaxhighlighter_3.0.83/scripts/shBrushXml.js"></script> 
<link type="text/css" rel="stylesheet" href="../js/syntaxhighlighter_3.0.83/styles/shThemeFadeToGrey.css"/>  

<script type="text/javascript">
    $(function() {
        // Fancy fonts
        Cufon.replace('.titillium');
        Cufon.replace('.engraved', {
            textShadow: 'rgba(253, 224, 217, 0.45) 1.2px 1px'	
        });
        
        // Syntax highlighting
        $("pre > code").each(function() {
            var codeText = $(this).text();
            $(this).parent().text(codeText).addClass("brush:js");
        });
        SyntaxHighlighter.defaults['toolbar'] = false;
        SyntaxHighlighter.defaults['gutter'] = false;
        SyntaxHighlighter.all();
        
        // Highlight current top menu item
        var desiredMenuItem = '' || 'documentation';
        $(".main-menu a[rel=" + desiredMenuItem + "]").addClass("active");
        
        // Highlight current left-hand-nav menu item
        var urlFilename = location.href.match(/\/([^\/]+)$/);
        if (urlFilename) {
            $(".leftColContents li:has(a[href$=" + urlFilename[1] + "])").addClass("active");
        }
    });
</script> 
    </head>
    <body>
        <div id="wrapper">
            <div class="vspace"></div>
            <div class="main-menu">
    <ul>
        <li><a rel="home" href="../index.html">Home</a></li>
        <li><a rel="installation" href="../documentation/installation.html">Download / Install</a></li>
        <li><a rel="tutorials" href="http://learn.knockoutjs.com/">Tutorials</a></li>
        <li><a rel="examples" href="../examples/">Live examples</a></li>
        <li><a rel="documentation" href="../documentation/introduction.html">Documentation</a></li>
        <li><a href="http://groups.google.com/group/knockoutjs">Forum</a></li>
        <li><a href="http://github.com/SteveSanderson/knockout">Source</a></li>
    </ul>
</div>        	
<div class="clear"></div>
            <div class="vspace"></div>
            <div>	
	<div class="leftCol">		
		<div class="leftColBackground">&nbsp;</div>
		<div class="leftColContents">
			<h1>Getting started</h1>

<ol>
    <li><a href="introduction.html">Why Twinkql?</a></li>
    <li><a href="installation.html">Downloading and installing</a></li>
</ol>

<h1>The Twinkql Context</h1>

<ol>
    <li><a href="observables.html">Creating <em>view models</em> with <em>observables</em></a></li>
    <li><a href="computedObservables.html">Using <em>computed observables</em></a></li>
    <li><a href="observableArrays.html">Working with <em>observable arrays</em></a></li>	
</ol>

<h1>Mapping</h1>

<h2>Configuration XML</h2>
<ol>
    <li><a href="visible-binding.html">The <code>visible</code> binding</a></li>
    <li><a href="text-binding.html">The <code>text</code> binding</a></li>
    <li><a href="html-binding.html">The <code>html</code> binding</a></li>
    <li><a href="css-binding.html">The <code>css</code> binding</a></li>
    <li><a href="style-binding.html">The <code>style</code> binding</a></li>
    <li><a href="attr-binding.html">The <code>attr</code> binding</a></li>
</ol>

<h2>Defining a SPARQL query</h2>
<ol>
    <li><a href="foreach-binding.html">The <code>foreach</code> binding</a></li>
    <li><a href="if-binding.html">The <code>if</code> binding</a></li>
    <li><a href="ifnot-binding.html">The <code>ifnot</code> binding</a></li>
    <li><a href="with-binding.html">The <code>with</code> binding</a></li>
</ol>

<h2>Working with ResultSets</h2>
<ol>
	<li><a href="after-callback.html">The <code>after</code> binding</a></li>
    <li><a href="click-binding.html">The <code>click</code> binding</a></li>
    <li><a href="event-binding.html">The <code>event</code> binding</a></li>
    <li><a href="submit-binding.html">The <code>submit</code> binding</a></li>
    <li><a href="enable-binding.html">The <code>enable</code> binding</a></li>
    <li><a href="disable-binding.html">The <code>disable</code> binding</a></li>
    <li><a href="value-binding.html">The <code>value</code> binding</a></li>
    <li><a href="hasfocus-binding.html">The <code>hasfocus</code> binding</a></li>
    <li><a href="checked-binding.html">The <code>checked</code> binding</a></li>
    <li><a href="options-binding.html">The <code>options</code> binding</a></li>
    <li><a href="selectedOptions-binding.html">The <code>selectedOptions</code> binding</a></li>    
    <li><a href="uniqueName-binding.html">The <code>uniqueName</code> binding</a></li>		
</ol>

<h2>Spring integration</h2>
<ol>
    <li><a href="custom-bindings.html">Creating custom bindings</a></li>
    <li><a href="custom-bindings-controlling-descendant-bindings.html">Controlling descendant bindings</a></li>
    <li><a href="custom-bindings-for-virtual-elements.html">Supporting virtual elements</a></li>
</ol>

<h1>More information</h1>
<ol>
    <li><a href="browser-support.html">Browser support</a></li>
    <li><a href="http://groups.google.com/group/knockoutjs">Getting help</a></li>
    <li><a href="links.html">Links to tutorials &amp; examples</a></li>
    <li><a href="amd-loading.html">Usage with AMD using RequireJs (Asynchronous Module Definition)</a></li>
</ol>

		</div>		
	</div>
	<div class="rightCol">
		<div class="documentation sticker">
		    <div class="content">
		    	<h1>Using extenders to augment observables</h1>	
		    	<p>Knockout observables provide the basic features necessary to support reading/writing values and notifying subscribers when that value changes. In some cases, though, you may wish to add additional functionality to an observable. This might include adding additional properties to the observable or intercepting writes by placing a writeable computed observable in front of the observable. Knockout extenders provide an easy and flexible way to do this type of augmentation to an observable.</p>

<h3 id='how_to_create_an_extender'>How to create an extender</h3>

<p>Creating an extender involves adding a function to the <code>ko.extenders</code> object. The function takes in the observable itself as the first argument and any options in the second argument. It can then either return the observable or return something new like a computed observable that uses the original observable in some way.</p>

<p>This simple <code>logChange</code> extender subscribes to the observable and uses the console to write any changes along with a configurable message.</p>

<pre><code>ko.extenders.logChange = function(target, option) {
    target.subscribe(function(newValue) {
       console.log(option + &quot;: &quot; + newValue);
    });
    return target;
};</code></pre>

<p>You would use this extender by calling the <code>extend</code> function of an observable and passing an object that contains a <code>logChange</code> property.</p>

<pre><code>this.firstName = ko.observable(&quot;Bob&quot;).extend({logChange: &quot;first name&quot;});</code></pre>

<p>If the <code>firstName</code> observable&#8217;s value was changed to <code>Ted</code>, then the console would show <code>first name: Ted</code>.</p>

<h3 id='live_example_1_forcing_input_to_be_numeric'>Live Example 1: Forcing input to be numeric</h3>

<p>This example creates an extender that forces writes to an observable to be numeric rounded to a configurable level of precision. In this case, the extender will return a new writeable computed observable that will sit in front of the real observable intercepting writes.</p>
<style type='text/css'>
   .error {  color: red; }
   .error input { border: 1px solid red; }
</style><div class='liveExample' id='numericFields'>

<p><input data-bind='value: myNumberOne' /> (round to whole number)</p>
<p><input data-bind='value: myNumberTwo' /> (round to two decimals)</p>

<script type='text/javascript'>

// Temporarily redirect ko.applyBindings to scope it to this live example
var realKoApplyBindings = ko.applyBindings;
ko.applyBindings = function() {
	if (arguments.length === 1)
		return ko.applyBindings(arguments[0], document.getElementById('numericFields'));
	return realKoApplyBindings.apply(ko, arguments);
}

/*<![CDATA[*/
ko.extenders.numeric = function(target, precision) {
    //create a writeable computed observable to intercept writes to our observable
    var result = ko.computed({
        read: target,  //always return the original observables value
        write: function(newValue) {
            var current = target(),
                roundingMultiplier = Math.pow(10, precision),
                newValueAsNum = isNaN(newValue) ? 0 : parseFloat(+newValue),
                valueToWrite = Math.round(newValueAsNum * roundingMultiplier) / roundingMultiplier;

            //only write if it changed
            if (valueToWrite !== current) {
                target(valueToWrite);
            } else {
                //if the rounded value is the same, but a different value was written, force a notification for the current field
                if (newValue !== current) {
                    target.notifySubscribers(valueToWrite);
                }
            }
        }
    });

    //initialize with current value to make sure it is rounded appropriately
    result(target());

    //return the new computed observable
    return result;
};

function AppViewModel(one, two) {
    this.myNumberOne = ko.observable(one).extend({ numeric: 0 });
    this.myNumberTwo = ko.observable(two).extend({ numeric: 2 });
}

ko.applyBindings(new AppViewModel(221.2234, 123.4525));
/*]]>*/

ko.applyBindings = realKoApplyBindings;

</script>
</div><h4>Source code: View</h4><pre class='brush:html'>
&lt;p&gt;&lt;input data-bind=&quot;value: myNumberOne&quot; /&gt; (round to whole number)&lt;/p&gt;
&lt;p&gt;&lt;input data-bind=&quot;value: myNumberTwo&quot; /&gt; (round to two decimals)&lt;/p&gt;
</pre><h4>Source code: View model</h4><pre class='brush:js'>
ko.extenders.numeric = function(target, precision) {
    //create a writeable computed observable to intercept writes to our observable
    var result = ko.computed({
        read: target,  //always return the original observables value
        write: function(newValue) {
            var current = target(),
                roundingMultiplier = Math.pow(10, precision),
                newValueAsNum = isNaN(newValue) ? 0 : parseFloat(+newValue),
                valueToWrite = Math.round(newValueAsNum * roundingMultiplier) / roundingMultiplier;

            //only write if it changed
            if (valueToWrite !== current) {
                target(valueToWrite);
            } else {
                //if the rounded value is the same, but a different value was written, force a notification for the current field
                if (newValue !== current) {
                    target.notifySubscribers(valueToWrite);
                }
            }
        }
    });

    //initialize with current value to make sure it is rounded appropriately
    result(target());

    //return the new computed observable
    return result;
};

function AppViewModel(one, two) {
    this.myNumberOne = ko.observable(one).extend({ numeric: 0 });
    this.myNumberTwo = ko.observable(two).extend({ numeric: 2 });
}

ko.applyBindings(new AppViewModel(221.2234, 123.4525));
</pre>
<h3 id='live_example_2_adding_validation_to_an_observable'>Live Example 2: Adding validation to an observable</h3>

<p>This example creates an extender that allows an observable to be marked as required. Instead of returning a new object, this extender simply adds additional sub-observables to the existing observable. Since observables are functions, they can actually have their own properties. However, when the view model is converted to JSON, the sub-observables will be dropped and we will simply be left with the value of our actual observable. This is a nice way to add additional functionality that is only relevant for the UI and does not need to be sent back to the server.</p>
<div class='liveExample' id='requiredFields'>

<p data-bind='css: { error: firstName.hasError }'>
    <input data-bind='value: firstName, valueUpdate: "afterkeydown"' />
    <span data-bind='visible: firstName.hasError, text: firstName.validationMessage'> </span>
</p>
<p data-bind='css: { error: lastName.hasError }'>
    <input data-bind='value: lastName, valueUpdate: "afterkeydown"' />
    <span data-bind='visible: lastName.hasError, text: lastName.validationMessage'> </span>
</p>

<script type='text/javascript'>

// Temporarily redirect ko.applyBindings to scope it to this live example
var realKoApplyBindings = ko.applyBindings;
ko.applyBindings = function() {
	if (arguments.length === 1)
		return ko.applyBindings(arguments[0], document.getElementById('requiredFields'));
	return realKoApplyBindings.apply(ko, arguments);
}

/*<![CDATA[*/
ko.extenders.required = function(target, overrideMessage) {
    //add some sub-observables to our observable
    target.hasError = ko.observable();
    target.validationMessage = ko.observable();

    //define a function to do validation
    function validate(newValue) {
       target.hasError(newValue ? false : true);
       target.validationMessage(newValue ? "" : overrideMessage || "This field is required");
    }

    //initial validation
    validate(target());

    //validate whenever the value changes
    target.subscribe(validate);

    //return the original observable
    return target;
};

function AppViewModel(first, last) {
    this.firstName = ko.observable(first).extend({ required: "Please enter a first name" });
    this.lastName = ko.observable(last).extend({ required: "" });
}

ko.applyBindings(new AppViewModel("Bob","Smith"));
/*]]>*/

ko.applyBindings = realKoApplyBindings;

</script>
</div><h4>Source code: View</h4><pre class='brush:html'>
&lt;p data-bind=&quot;css: { error: firstName.hasError }&quot;&gt;
    &lt;input data-bind='value: firstName, valueUpdate: &quot;afterkeydown&quot;' /&gt;
    &lt;span data-bind='visible: firstName.hasError, text: firstName.validationMessage'&gt; &lt;/span&gt;
&lt;/p&gt;
&lt;p data-bind=&quot;css: { error: lastName.hasError }&quot;&gt;
    &lt;input data-bind='value: lastName, valueUpdate: &quot;afterkeydown&quot;' /&gt;
    &lt;span data-bind='visible: lastName.hasError, text: lastName.validationMessage'&gt; &lt;/span&gt;
&lt;/p&gt;
</pre><h4>Source code: View model</h4><pre class='brush:js'>
ko.extenders.required = function(target, overrideMessage) {
    //add some sub-observables to our observable
    target.hasError = ko.observable();
    target.validationMessage = ko.observable();

    //define a function to do validation
    function validate(newValue) {
       target.hasError(newValue ? false : true);
       target.validationMessage(newValue ? &quot;&quot; : overrideMessage || &quot;This field is required&quot;);
    }

    //initial validation
    validate(target());

    //validate whenever the value changes
    target.subscribe(validate);

    //return the original observable
    return target;
};

function AppViewModel(first, last) {
    this.firstName = ko.observable(first).extend({ required: &quot;Please enter a first name&quot; });
    this.lastName = ko.observable(last).extend({ required: &quot;&quot; });
}

ko.applyBindings(new AppViewModel(&quot;Bob&quot;,&quot;Smith&quot;));
</pre>
<h3 id='applying_multiple_extenders'>Applying multiple extenders</h3>

<p>More than one extender can be applied in a single call to the <code>.extend</code> method of an observable.</p>

<pre><code>this.firstName = ko.observable(first).extend({ required: &quot;Please enter a first name&quot;, logChange: &quot;first name&quot; });</code></pre>

<p>In this case, both the <code>required</code> and <code>logChange</code> extenders would be executed against our observable.</p>    
		    </div>
		    
		    <div class="clear"></div>
		</div>
	</div>	
</div>
            <div class="clear"></div>
            <div class="main-menu">
    <ul>
        <li><a rel="home" href="../index.html">Home</a></li>
        <li><a rel="installation" href="../documentation/installation.html">Download / Install</a></li>
        <li><a rel="tutorials" href="http://learn.knockoutjs.com/">Tutorials</a></li>
        <li><a rel="examples" href="../examples/">Live examples</a></li>
        <li><a rel="documentation" href="../documentation/introduction.html">Documentation</a></li>
        <li><a href="http://groups.google.com/group/knockoutjs">Forum</a></li>
        <li><a href="http://github.com/SteveSanderson/knockout">Source</a></li>
    </ul>
</div>        	
<div class="clear"></div>
        </div>
        
        <div id="page-footer">(c) twinkql.org</div> 
        
		  <script type="text/javascript">
		
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-32297409-1']);
		  _gaq.push(['_trackPageview']);
		
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		
			</script>
    </body>
</html>